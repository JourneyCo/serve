<div class="project-form-container">
  <h2 mat-dialog-title>{{ dialogTitle }}</h2>

  <form [formGroup]="projectForm" (ngSubmit)="onSubmit()">
    <mat-dialog-content>
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Project Title</mat-label>
          <input
            matInput
            formControlName="title"
            placeholder="Enter project title"
            required
          />
          @if (projectForm.get("title")?.hasError("required")) {
            <mat-error> Title is required </mat-error>
          }
          @if (projectForm.get("title")?.hasError("maxlength")) {
            <mat-error> Title cannot exceed 100 characters </mat-error>
          }
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Short Description</mat-label>
          <textarea
            matInput
            formControlName="short_description"
            placeholder="Enter a brief summary"
            rows="2"
            required
          ></textarea>
          @if (projectForm.get("short_description")?.hasError("required")) {
            <mat-error> Short description is required </mat-error>
          }
          @if (projectForm.get("short_description")?.hasError("maxlength")) {
            <mat-error>
              Short description cannot exceed 200 characters
            </mat-error>
          }
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Full Description</mat-label>
          <textarea
            matInput
            formControlName="description"
            placeholder="Enter detailed project description"
            rows="4"
            required
          ></textarea>
          @if (projectForm.get("description")?.hasError("required")) {
            <mat-error> Description is required </mat-error>
          }
          @if (projectForm.get("description")?.hasError("minlength")) {
            <mat-error> Description must be at least 10 characters </mat-error>
          }
        </mat-form-field>
      </div>

      <div class="form-row time-row">
        <mat-form-field appearance="outline">
          <mat-label>Start Time</mat-label>
          <input matInput type="time" formControlName="start_time" required />
          @if (projectForm.get("start_time")?.hasError("required")) {
            <mat-error> Start time is required </mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>End Time</mat-label>
          <input matInput type="time" formControlName="end_time" required />
          @if (projectForm.get("end_time")?.hasError("required")) {
            <mat-error> End time is required </mat-error>
          }
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Maximum Capacity</mat-label>
          <input
            matInput
            type="number"
            formControlName="max_capacity"
            min="1"
            max="1000"
            required
          />
          @if (projectForm.get("max_capacity")?.hasError("required")) {
            <mat-error> Maximum capacity is required </mat-error>
          }
          @if (projectForm.get("max_capacity")?.hasError("min")) {
            <mat-error> Minimum capacity is 1 </mat-error>
          }
          @if (projectForm.get("max_capacity")?.hasError("max")) {
            <mat-error> Maximum capacity cannot exceed 1000 </mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Location Information Section -->
      <div class="section-label">
        <h3>Location Information (Optional)</h3>
        <p class="helper-text">
          Enter a location address and coordinates will be automatically
          generated, or click the map pin icon to manually trigger geocoding.
        </p>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="location-field">
          <mat-label>Location Address</mat-label>
          <input
            matInput
            formControlName="location_name"
            placeholder="e.g., 123 Main St, San Francisco, CA"
          />
          @if (projectForm.get("location_name")?.value && !geocoding) {
            <button
              type="button"
              matSuffix
              mat-icon-button
              (click)="geocodeLocation(projectForm.get('location_name')?.value)"
              aria-label="Geocode address"
              matTooltip="Find coordinates for this address"
            >
              <mat-icon>pin_drop</mat-icon>
            </button>
          }
          @if (geocoding) {
            <mat-spinner matSuffix diameter="20"> </mat-spinner>
          }
        </mat-form-field>
      </div>

      <div class="form-row coordinates-row">
        <mat-form-field appearance="outline">
          <mat-label>Latitude</mat-label>
          <input
            matInput
            formControlName="latitude"
            placeholder="e.g., 37.7749"
          />
          @if (projectForm.get("latitude")?.hasError("pattern")) {
            <mat-error> Please enter a valid latitude value </mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Longitude</mat-label>
          <input
            matInput
            formControlName="longitude"
            placeholder="e.g., -122.4194"
          />
          @if (projectForm.get("longitude")?.hasError("pattern")) {
            <mat-error> Please enter a valid longitude value </mat-error>
          }
        </mat-form-field>
      </div>

      @if (projectForm.hasError("timeRange")) {
        <div class="date-range-error">End time must be after start time</div>
      }
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button mat-dialog-close [disabled]="submitting">
        Cancel
      </button>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="projectForm.invalid || submitting"
      >
        <mat-icon>save</mat-icon>
        @if (!submitting) {
          <span>{{ data.isEdit ? "Update" : "Create" }}</span>
        }
        @if (submitting) {
          <span>Saving...</span>
        }
      </button>
    </mat-dialog-actions>
  </form>
</div>
